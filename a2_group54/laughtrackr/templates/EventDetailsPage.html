{% extends 'base.html' %}

{% block content %}
<main class="container mt-5 pt-5">

  <!-- Event Image -->
  <div class="row mb-4">
    {% if event.image %}
      <img src="{{ url_for('static', filename=event.image) }}" class="img-fluid" alt="{{ event.name }} Banner">
    {% else %}
      <p class="text-light">No image available for this event.</p>
    {% endif %}
  </div>

  <!-- Two-column layout: Event Info (left) + Ticket Form (right) -->
  <div class="row">
    <!-- Left Column: Event Description -->
    <div class="col-md-6">
      <div class="text_pill p-3 bg rounded", style="background-color: #ffbfbf">
        <h2><strong>{{ event.name }}</strong></h2>
        <p>{{ event.description }}</p>

        <div class="accordion accordion-flush" id="eventAccordion">
          <!-- Event Details -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
              <button class="accordion-button collapsed" type="button"
                      data-bs-toggle="collapse" data-bs-target="#flush-collapseOne"
                      aria-expanded="false" aria-controls="flush-collapseOne">
                Event Details
              </button>
            </h2>
            <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne">
              <div class="accordion-body">
                <p>Date: {{ event.event_date.strftime('%B %d, %Y') }}</p>
                <p>Start Time: {{ event.event_date.strftime('%I:%M %p') }}</p>
                <p>Venue: {{ event.venue.name }}</p>
                <p>Location: {{ event.venue.address }}</p>
                <p>Rating: {{ event.rating.label }}</p>
              </div>
            </div>
          </div>

          <!-- Additional Info -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingThree">
              <button class="accordion-button collapsed" type="button"
                      data-bs-toggle="collapse" data-bs-target="#flush-collapseThree"
                      aria-expanded="false" aria-controls="flush-collapseThree">
                Additional Information
              </button>
            </h2>
            <div id="flush-collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree">
              <div class="accordion-body">
                <p>{{ event.event_addinfo }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Ticket Purchase Form -->
    <div class="col-md-6">
      <div class="text_pill p-3 bg rounded" style="background-color: #ffbfbf">
        <form method="POST" action="{{ url_for('booking.book_event', event_id=event.id) }}" class="row g-3">
          {{ form.hidden_tag() }}

          <!-- Ticket Quantity -->
          <div class="mb-3">
            {{ form.quantity.label(class="form-label") }}
            {{ form.quantity(class="form-select is-valid", id="validation0") }}
            <div class="valid-feedback">Tickets Available!</div>
          </div>

          <!-- Purchase Button and Total -->
          <div class="row align-items-center my-4">
            <div class="col">
              {{ form.submit(class="btn btn-primary", aria_label="Purchase tickets") }}
            </div>
            <div class="col">
              <div class="mb-3 border rounded-pill bg-white">
                <label id="TotalCost" class="form-label px-3">Total:</label>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Ticket price change script -->
  <script>
    const dropdown = document.getElementById('validation0');
    const label = document.getElementById('TotalCost');
    const ticketCost = parseFloat("{{ event.cost | float }}");

    dropdown.addEventListener('change', () => {
      const value = parseInt(dropdown.value);
      label.textContent = !isNaN(value)
        ? `Total: $ ${value * ticketCost}`
        : 'Total: $ 0.00';
    });
  </script>

 <!-- Comment Section -->
<section class="mt-5">
  <div class="container">
    <h4 class="text-white">Comments</h4>

    <form method="POST" action="{{ url_for('events.event_details', id=event.id) }}">
      {{ comment_form.hidden_tag() }}
      <div class="mb-3">
        {{ comment_form.text(class="form-control", rows="3", placeholder="What did you think of this event?", aria_label="Comment input") }}
      </div>
      {{ comment_form.submit(class="btn btn-outline-light", aria_label="Post comment") }}
    </form>

    <hr class="text-white">

    {% for comment in comments %}
      <div class="card bg-dark text-white mb-3">
        <div class="card-body">
          <h6 class="card-title mb-1">{{ comment.user.name }}</h6>
          <p class="card-subtitle text-muted small">{{ comment.created_at.strftime('%d %b %Y %I:%M %p') }}</p>
          <p class="card-text mt-2">{{ comment.text }}</p>
        </div>
      </div>
    {% else %}
      <p class="text-light">No comments yet â€” be the first to share your thoughts!</p>
    {% endfor %}
  </div>
</section>

{% endblock %}